<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro" name="platform">

    <xacro:macro name="rocker" params="parent name side_name rpy xyz axis effort velocity low_limit high_limit friction damping" >

        <!-- LINK -->
        <xacro:macro name="rocker_geo_1">
            <origin rpy="1.57075 0 0" xyz="0 0 0"/>
            <geometry>
                <cylinder length="0.05" radius="0.05"/>
            </geometry>
        </xacro:macro>

        <xacro:macro name="rocker_geo_2">
            <origin rpy="0 0 0" xyz="0 0 -0.07"/>
            <geometry>
                <box size="0.8 0.1 0.14"/>
            </geometry>
        </xacro:macro>

        <xacro:macro name="rocker_mesh">
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <xacro:if value="${side_name == 'l'}">
                <geometry>
                    <mesh filename="package://kalman_description/meshes/201_rocker_l.STL" scale="0.001 0.001 0.001"/>
                </geometry>
            </xacro:if>
            <xacro:if value="${side_name == 'r'}">
                <geometry>
                    <mesh filename="package://kalman_description/meshes/201_rocker_r.STL" scale="0.001 0.001 0.001"/>
                </geometry>
            </xacro:if>
        </xacro:macro>

        <xacro:macro name="rocker_color">
            <material name="light_gray">
                <color rgba=".7 .7 .7 1"/>
            </material>
        </xacro:macro>

        <link name="${name}">
            <visual>
                    <!-- <xacro:rocker_mesh/> -->
                    <xacro:rocker_color/>
            </visual>


            <visual>
                    <xacro:rocker_geo_1/>
                    <xacro:rocker_color/>
            </visual>

            <!-- <visual>
                    <xacro:rocker_geo_2/>
                    <xacro:rocker_color/>
            </visual> -->

            <xacro:cylinder_inertial radius="0.05" length="0.8" mass="3.5">
                <origin xyz="0.0 0.0 -0.07" rpy="0 1.57075 0" />
            </xacro:cylinder_inertial>

        </link>
        <gazebo reference="${name}">
            <mu1> .2 </mu1>
            <mu2> .2 </mu2>
            <material> Gazebo/FlatBlack </material>
            <selfCollide>False</selfCollide>
        </gazebo>

        <joint name="${name}_joint" type="revolute">
            <parent link="${parent}"/>
            <child link="${name}"/>
            <origin rpy="${rpy}" xyz="${xyz}"/>
            <axis xyz="${axis}"/>
            <limit effort="${effort}" velocity="${velocity}" lower="${low_limit}" upper="${high_limit}"/>
            <dynamics friction="${friction}" damping="${damping}"/>
        </joint>
        <gazebo reference="${name}_joint">
            <stopCfm>0.8</stopCfm>
            <stopErp>0.1</stopErp>
            <provideFeedback>true</provideFeedback>
            <implicitSpringDamper>true</implicitSpringDamper>
            <fudgeFactor>0.0</fudgeFactor>
        </gazebo>

        <!-- ENCODER -->
        <gazebo>
            <plugin name="${name}_encoder" filename="libJointEncoder.so">
                <joint>${name}_joint</joint>
                <topic>/kalman/simulation/encoder/${name}_abs</topic>
                <absolute>1</absolute>
                <resolution>3600</resolution>
            </plugin>
        </gazebo>

    </xacro:macro>
</robot>
